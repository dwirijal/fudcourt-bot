generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Ohlcv {
  id        Int      @id @default(autoincrement())
  symbol    String
  timeframe String
  timestamp BigInt
  open      Float
  high      Float
  low       Float
  close     Float
  volume    Float
  createdAt DateTime @default(now())

  @@unique([symbol, timeframe, timestamp])
  @@index([symbol, timeframe])
}

model CoinGeckoData {
  id                          String   @id // coin_id
  symbol                      String
  name                        String
  current_price               Float?
  market_cap                  Float?
  market_cap_rank             Int?
  fully_diluted_valuation     Float?
  total_volume                Float?
  high_24h                    Float?
  low_24h                     Float?
  price_change_24h            Float?
  price_change_percentage_24h Float?
  price_change_percentage_7d  Float?
  price_change_percentage_30d Float?
  circulating_supply          Float?
  total_supply                Float?
  max_supply                  Float?
  ath                         Float?
  ath_change_percentage       Float?
  ath_date                    String?
  atl                         Float?
  atl_change_percentage       Float?
  atl_date                    String?
  last_updated                String?
  fetched_at                  BigInt
}

// Player Data
model User {
  id          String   @id // Discord User ID
  username    String?  // Optional, for caching display name
  job         String   @default("Novice") // Warrior, Mage, Rogue (formerly class)
  level       Int      @default(1)
  xp          Int      @default(0)
  gold        Int      @default(100)
  potions     Int      @default(3)
  
  // Equipment
  equippedWeapon String @default("Wooden Stick")
  
  // Economy & Cooldowns
  lastDaily   DateTime?
  lastWork    DateTime?
  
  // Relations
  inventory   InventoryItem[]
  stats       UserStats?
  dailyStreak Int      @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Inventory System
model InventoryItem {
  id        Int    @id @default(autoincrement())
  userId    String
  user      User   @relation(fields: [userId], references: [id])
  itemName  String
  rarity    String // Common, Rare, Epic, Legendary
  damage    Int
  quantity  Int    @default(1)
}

// Leaderboard Stats
model UserStats {
  userId      String @id
  user        User   @relation(fields: [userId], references: [id])
  battlesWon  Int    @default(0)
  bossDamage  Int    @default(0)
}

// Global Raid Boss State
model RaidBoss {
  id          Int    @id @default(1)
  name        String @default("World Eater")
  level       Int    @default(1)
  hp          Int    @default(10000) // currentHP
  maxHp       Int    @default(10000) // maxHP
  isDead      Boolean @default(false)
}

// RSS Feed History (Deduplication)
model FeedHistory {
  id        Int      @id @default(autoincrement())
  feedType  String   // 'JOB' or 'NEWS'
  uniqueId  String   // GUID or URL
  createdAt DateTime @default(now())

  @@unique([feedType, uniqueId])
}
